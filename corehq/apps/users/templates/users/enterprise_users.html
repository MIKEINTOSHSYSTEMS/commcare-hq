{% extends 'hqwebapp/base_section.html' %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load hq_shared_tags %}

{% requirejs_main 'users/js/enterprise_users' %}

{% block page_content %}
  {% registerurl "paginate_enterprise_users" domain %}

  <p class="lead">
    {% blocktrans %}
      This page is new and special.
    {% endblocktrans %}
  </p>

  <div class="panel panel-default ko-template" id="web-users-panel">
    <div class="panel-heading">
      <div class="row">
        <div class="col-sm-6">
          <h3 class="panel-title" style="padding-top: 7px;">{% trans 'Current Users' %}</h3>
        </div>
        <div class="col-sm-6">
          <search-box data-apply-bindings="false"
                      params="value: query,
                              action: function() { goToPage(1); },
                              placeholder: '{% trans_html_attr "Search Users..." %}'"></search-box>
        </div>
      </div>
    </div>
    <div class="panel-body">
      <div class="alert alert-danger" data-bind="visible: error, text: error"></div>
      <div data-bind="visible: showLoadingSpinner">
        <i class="fa fa-spin fa-spinner"></i>
        {% trans "Loading Users..." %}
      </div>
      <div data-bind="visible: noUsersMessage">
        <p class="alert alert-info">
          <i class="fa fa-info-circle"></i>
          <!-- ko text: noUsersMessage --><!-- /ko -->
        </p>
      </div>
      <table class="table table-striped table-responsive"
             data-bind="visible: showUsers"
             style="margin-bottom: 0;">
        <thead>
          <tr>
            <th>{% trans "Email Address" %}</th>
            <th>{% trans "Role" %}</th>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Phone Numbers" %}</th>
            {% if not request.is_view_only %}
              <th></th>
            {% endif %}
          </tr>
        </thead>
        <tbody data-bind="foreach: users">
          <tr>
            <td>
              <a data-bind="attr: {href: editUrl}, text: email"></a>
              {% if request|toggle_enabled:"ENTERPRISE_SSO" %}
                <span class="label label-warning"
                      data-bind="if: isUntrustedIdentityProvider">
                  <i class="fa fa-warning"></i>
                  {% trans "SSO Identity Provider is not trusted." %}
                </span>
              {% endif %}
            </td>
            <td data-bind="text: role"></td>
            <td data-bind="text: name"></td>
            <td>
              <ul data-bind="foreach: phoneNumbers">
                <li data-bind="text: $data"></li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
      <pagination data-bind="visible: showUsers" data-apply-bindings="false"
                  params="goToPage: goToPage,
                          slug: 'web-users',
                          perPage: itemsPerPage,
                          maxPagesShown: 10,
                          totalItems: totalItems,
                          onLoad: onPaginationLoad,
                          showSpinner: showPaginationSpinner"></pagination>

    </div><!-- end .panel-body -->
  </div><!-- end .panel -->

{% endblock %}