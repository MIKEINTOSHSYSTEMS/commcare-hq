{% load hq_shared_tags %}
{% load i18n %}

<div id="ko-tabs-manage-downstream" class="ko-template">
  <h3>{% trans "Manage Downstream Projects" %}</h3>
  <p>
    {% blocktrans %}
      This project is an upstream project space for the projects listed below.<br/>
      <a href="#" target="_blank">Learn more</a> about Linked Projects.
    {% endblocktrans %}
  </p>
  {% if is_erm_ff_enabled %}
    <button type="button"
            class="btn btn-primary"
            id="add-downstream-domain"
            data-toggle="modal"
            data-target="#new-downstream-domain-modal">
      <i class="fa fa-plus"></i> {% trans "Add Downstream Project" %}
    </button>
  {% endif %}
  <div class="spacer"></div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">{% trans 'Downstream Projects' %}</h3>
    </div>
    <div class="panel-body">
      <search-box data-apply-bindings="false"
                params="value: query,
                        action: filter,
                        immediate: true,
                        placeholder: '{% trans_html_attr "Search Downstream Projects..." %}'"></search-box>
      <div data-bind="if: domain_links().length">
        <table class="table table-striped table-hover" id="linked-domains-table">
          <thead>
          <tr>
            <th>{% trans "Project Name" %}</th>
            <th>{% trans "Last Updated" %} ({{ timezone }})</th>
            <th></th>
          </tr>
          </thead>
          <tbody data-bind="foreach: paginatedDomainLinks">
          <tr>
            <td><a data-bind="attr: {'href': downstreamUrl}, text: linked_domain"></a></td>
            <td data-bind="text: lastUpdate"></td>
            <td>
              <button type="button" class="btn btn-danger" data-toggle="modal" data-bind="attr: {'data-target': '#remove-link-modal-' + $index()}">
                <i class="fa fa-trash"></i>
                {% trans 'Remove Link' %}
              </button>
              <div class="modal fade" tabindex="-1" role="dialog" data-bind="attr: {'id': 'remove-link-modal-' + $index()}">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label='{% trans_html_attr "Close" %}'><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title">{% trans 'Remove Project Link' %}</h4>
                    </div>
                    <div class="modal-body">
                      <h4>
                        {% blocktrans %}
                          Are you sure you want to remove the downstream link to <b data-bind="text: linked_domain"></b>?
                        {% endblocktrans %}
                      </h4>
                      <p>
                        {% blocktrans %}
                          Removing the link will also remove links between upstream and downstream data models.<br/>
                          <a href="#" target="_blank">Learn more</a> about what happens when downstream project links are removed.
                        {% endblocktrans %}
                      </p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">{% trans 'Cancel' %}</button>
                      <button type="button" class="btn btn-danger" data-bind="click: $root.deleteLink.bind($data)" data-dismiss="modal">{% trans 'Remove' %}</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
        <pagination data-apply-bindings="false"
          params="goToPage: goToPage,
                  perPage: itemsPerPage,
                  totalItems: totalItems,
                  onLoad: onPaginationLoad"></pagination>
      </div>
    </div>
  </div>
</div>
