{% load hq_shared_tags %}
{% load i18n %}

<script type="text/template" id="restore-as-view-template">
  <div class="module-menu-container">
    <div class="page-header menu-header">
      <h1 class="page-title">Login as user</h1>
    </div>
    <form class="module-search-container js-user-search">
      <div class="input-group input-group-lg">
        <input
          type="text"
          class="js-user-query form-control"
          value="<%= query %>"
          placeholder="Filter workers" />
        <div class="input-group-btn">
          <button class="btn btn-default" type="submit">
            <i class="fa fa-search" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </form>
    <table class="table module-table">
      <tbody>
      </tbody>
    </table>
    <% if (pagesToShow.endPage) { %>
      <div class="container">
        <div class="row">
          <div class="col-sm-3">
          <div class="form-inline user-rows-perpage">
            <span class="page-text">Rows per page</span>
            <select class="form-control js-page-series user-page-options" id="itemsText">
              <option value="<%= limit %>"><%= limit %> per page</option>
              <% for(var i = 0; i < rowRange.length; i++) { %>
                <% if (rowRange[i] != limit) { %>
                  <option value="<%= rowRange[i] %>"><%= rowRange[i] %> per page</option>
                <% } %>
              <% } %>
            </select>
          </div>
        </div>
          <div class="col-sm-6">
            <nav class="module-pagination-container text-centre pagination-align">
            <ul class="pagination">

              <!-- Render Previous button -->
              <% if (page === 1) { %>
              <li class="disabled">
                <% } else { %>
              <li>
                <% } %>
                <a class="js-page" data-page="1">
                  <span><i class="fa fa-fast-backward"></i></span>
                </a>
                <a class="js-user-previous">
                  <span><i class="fa fa-caret-left"></i></span>
                </a>
              </li>
              <!-- Render page buttons -->
              <% if (pagesToShow.pageCount <= 5) { %>
                  <% for (i = pagesToShow.startPage-1; i < pagesToShow.endPage; i++) { %>
                    <li class="js-page<% if (i+1 === page) { %> active<% } %>" data-page="<%= i+1 %>"><a><%= i + 1 %></a></li>
                  <% } %>
              <% } else { %>
                <% if (pagesToShow.startPage <= 3) { %>
                  <% for (i = 1; i < pagesToShow.startPage; i++) { %>
                    <li class="js-page<% if (i === page) { %> active<% } %>" data-page="<%= i %>"><a><%= i %></a></li>
                  <% } %>
                <% } else { %>
                    <li class="js-page<% if (i === page) { %> active<% } %>" data-page="1"><a>{% trans "1" %}</a></li>
                    <li class="js-page"><a class="paginate-disabled">{% trans "..." %}</a></li>
                <% } %>
                <% for (i = pagesToShow.startPage; i <= pagesToShow.endPage; i++) { %>
                  <li class="js-page<% if (i === page) { %> active<% } %>" data-page="<%= i %>"><a><%= i %></a></li>
                <% } %>
                <% if (pagesToShow.endPage >= pagesToShow.pageCount - 2) { %>
                  <% for (i = pagesToShow.endPage+1; i <= pagesToShow.pageCount; i++) { %>
                    <li class="js-page<% if (i === page) { %> active<% } %>" data-page="<%= i %>"><a><%= i %></a></li>
                  <% } %>
                <% } else { %>
                  <li class="js-page"><a class="paginate-disabled">{% trans "..." %}</a></li>
                  <li class="js-page<% if (i === page) { %> active<% } %>" data-page="<%= pagesToShow.pageCount %>"><a><%= pagesToShow.pageCount %></a></li>
                <% } %>
              <% } %>
              <!-- Render Next buttons -->
              <% if (page === totalPages) { %>
              <li class="disabled">
                <% } else { %>
              <li>
                <% } %>
                <a class="js-user-next">
                  <span><i class="fa fa-caret-right"></i></span>
                </a>
                <a class="js-page" data-page="<%= pagesToShow.pageCount %>">
                  <span><i class="fa fa-fast-forward"></i></span>
                </a>
              </li>
            </ul>
            </nav>
          </div>
          <div class="col-sm-3">
            <div class="form-inline paginate-goto">
                <span class="page-text">{% trans "Go to page" %}</span>
                <input type="text" class="form-control pagination-user-form" style="width: 60px;" placeholder="Page" id="goText">
                <input type="button" class="btn btn-primary js-page-go-search pagination-user-form" value="Go">
            </div>
          </div>
        </div>
      </div>
    <% } %>
  </div>
</script>

<script type="text/template" id="user-row-view-template">
  <td class="module-column module-column-icon">
    <div class="module-icon-container module-icon-user">
      <i class="fa fa-user module-icon" aria-hidden="true"></i>
    </div>
  </td>
  <td class="module-column module-column-name">
    <h3>
      <b><%= username %></b>
      <span><%- first_name + ' ' + last_name %></span>
      <i><small><%= location ? location.name + ' (' + location.location_type + ')' : '' %></small></i>
    </h3>
  </td>
</script>

<script type="text/template" id="user-data-template">
  <table class="table module-table module-table-casedetail">
    <tbody>
    <tr>
      <th>{% trans "Name" %}</th>
      <td><%- user.first_name + ' ' + user.last_name %></td>
    </tr>
    <% if (user.location) { %>
    <tr>
      <th>{% trans "Organization" %}</th>
      <td><%= user.location.name %></td>
    </tr>
    <tr>
      <th>{% trans "Organization Type" %}</th>
      <td><%= user.location.location_type %></td>
    </tr>
    <% } %>
    <tr>
      <th>{% trans "Date Registered" %}</th>
      <td><%= user.dateRegistered %></td>
    </tr>
    <% _.each(user.customFields, function(value, key) { %>
    <% if (!key.startsWith('commcare_') && !key.startsWith('commtrack') && value) { %>
    <tr>
      <th><%= key %></th>
      <td><%= value %></td>
    </tr>
    <% } %>
    <% }) %>
    </tbody>
  </table>

</script>
<script type="text/template" id="restore-as-banner-template">
  {% if request|can_use_restore_as %}
    <% if (restoreAs) { %>
    <div class="restore-as-banner module-banner">
      {% blocktrans %}
        <span>
                Working as <b><%= restoreAs %></b>.
                <a class="js-clear-user">Use <%= username %>.</a>
            </span>
      {% endblocktrans %}
    </div>
    <% } %>
  {% endif %}
</script>
