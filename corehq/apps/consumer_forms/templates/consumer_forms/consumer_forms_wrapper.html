<html>
<head>
  <style>
    #body {
      margin: 1em auto;
      max-width: 1080px;
    }
  </style>
</head>
<body>
<div id="body">
  <h1>Example Consumer Form</h1>
  <p>This page is intentionally unstyled since the goal is for end-users to customize their own forms.</p>
  <h2>Case List</h2>
  <ul id="data-display"></ul>
  <iframe
    id="sandboxed"
    src="{% url 'consumer_forms:consumer_form_iframe' domain %}">
  </iframe>

</div>
</body>
{{ link_url|json_script:'commcare-data-url' }}
{{ domain|json_script:'domain' }}
<script>
  // or you could fetch this from the API
  const linkUrl= JSON.parse(document.getElementById('commcare-data-url').textContent);

  const renderData = function (commcareData) {
    console.log(commcareData);
    const dataDiv = document.getElementById('data-display');
    for (let i = 0; i < commcareData.length; i++) {
      let dataElt = document.createElement('li');
      dataElt.innerText = commcareData[i].name + ': ' + commcareData[i].case_id;
      dataDiv.appendChild(dataElt)
    }
  };

  fetch(linkUrl)
    .then(res => res.json())
    .then(
      (result) => {
        renderData(result.data);
      },
      (error) => {
        console.error(error);
      }
    );

</script>
</html>
