{% extends "hqwebapp/base_section.html" %}
{% load hq_shared_tags %}
{% load i18n %}

{% requirejs_main "linked_domain/js/domain_links" %}

{% block page_content %}
  {% initial_page_data 'view_data' view_data %}
  {% registerurl 'linked_domain:domain_link_rmi' domain %}
  {% registerurl 'app_settings' domain '---' %}

  {% if not is_master_domain and not is_linked_domain %}
    <div class="alert alert-info">
      {% trans "This project has no links to other projects." %}
    </div>
  {% endif %}

  {% if is_master_domain %}
    {% comment %}
      Keep the tab headers out of the .ko-template div because they use .sticky-tabs, which is subject
      to race condition problems if the tabs aren't visible when its document ready handler runs.
    {% endcomment %}
    <ul class="nav nav-tabs sticky-tabs">
      {% if is_linked_domain %}
        <li class="active"><a data-toggle="tab" href="#tabs-pull-content">{% trans "Manage Linked Project" %}</a></li>
      {% endif %}
      <li{% if not is_linked_domain %} class="active"{% endif %}><a data-toggle="tab" href="#tabs-manage-downstream">{% trans "Downstream Projects" %}</a></li>
      <li><a data-toggle="tab" href="#tabs-push-content">{% trans "Push Content" %}</a></li>
    </ul>
    <div class="spacer"></div>
  {% elif is_linked_domain %}
    <h2>{% trans "Manage Linked Project" %}</h2>  {# header for the only tab that will be displayed #}
  {% endif %}

  <div id="domain_links">
    <div class="tab-content">
      {% if is_linked_domain %}
        <div class="tab-pane fade in active" id="tabs-pull-content">
          {% include 'linked_domain/tabs/pull_release_content_tab.html' %}
        </div>
      {% endif %}
      <div class="tab-pane fade{% if not is_linked_domain %} in active{% endif %}" id="tabs-manage-downstream">
        {% include 'linked_domain/tabs/manage_downstream_domains_tab.html' %}
      </div>
      <div class="tab-pane fade" id="tabs-push-content">
        {% include 'linked_domain/tabs/push_release_content_tab.html' %}
      </div>
    </div>
  </div>
{% endblock %}

{% block modals %}
  {{ block.super }}
  <div class="modal fade" id="new-downstream-domain-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label='{% trans_html_attr "Close" %}'><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">{% trans 'Add Downstream Project' %}</h4>
        </div>
        <div class="modal-body">
          <div class="ko-model">
            <label >{% trans 'Project Space:' %}</label>
            <select class="form-control" data-bind="select2: availableDomains, value: value"></select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">{% trans 'Cancel' %}</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="click: addDownstreamDomain">{% trans 'Add' %}</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
